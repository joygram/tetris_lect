---
layout: default
title: 6ë‹¨ê³„ - í–‰ ì œê±° ì‹œìŠ¤í…œ
---

# 6ë‹¨ê³„: í–‰ ì œê±° ì‹œìŠ¤í…œ

## ğŸ¯ ì´ ë‹¨ê³„ì—ì„œ ë°°ìš¸ ê²ƒ

- ê°€ë“ ì°¬ í–‰ ê°ì§€
- í–‰ ì œê±° ë¡œì§
- ìœ„ ë¸”ë¡ë“¤ì„ ì•„ë˜ë¡œ ì´ë™
- ì ìˆ˜ ê³„ì‚°

## ğŸ“ ì‹¤ìŠµ ë‚´ìš©

### 1. ë¸”ë¡ì„ ë³´ë“œì— ê³ ì •í•˜ëŠ” í•¨ìˆ˜

ë¨¼ì € ë¸”ë¡ì´ ë” ì´ìƒ ë‚´ë ¤ê°ˆ ìˆ˜ ì—†ì„ ë•Œ ë³´ë“œì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

`GameBoard.cs`ì— ì¶”ê°€:

```csharp
// ë¸”ë¡ì„ ê·¸ë¦¬ë“œì— ì¶”ê°€ (ê³ ì •)
// ì°¸ê³  ë¸”ë¡œê·¸ ë°©ì‹: ìì‹ ë¸”ë¡ë“¤ì„ ì§ì ‘ ì‚¬ìš©
public void AddToGrid(Tetromino tetromino)
{
    // ëª¨ë“  ìì‹ ë¸”ë¡ í™•ì¸
    for (int i = 0; i < tetromino.transform.childCount; i++)
    {
        Transform child = tetromino.transform.GetChild(i);
        
        // ìì‹ ë¸”ë¡ì˜ Unity ì›”ë“œ ì¢Œí‘œë¥¼ ì •ìˆ˜ë¡œ ë°˜ì˜¬ë¦¼
        int roundX = Mathf.RoundToInt(child.position.x);
        int roundY = Mathf.RoundToInt(child.position.y);
        
        // ë³´ë“œ ë²”ìœ„ í™•ì¸
        if (roundX >= 0 && roundX < width && roundY >= 0 && roundY < height)
        {
            // ë¶€ëª¨ë¥¼ GameBoardë¡œ ë³€ê²½ (ê³ ì •ëœ ë¸”ë¡ì´ë¯€ë¡œ)
            child.SetParent(transform);
            
            // ê·¸ë¦¬ë“œì— ì €ì¥
            grid[roundX, roundY] = child;
        }
    }
}
```

**ì‘ë™ ë°©ì‹**:
1. Tetrominoì˜ ëª¨ë“  ìì‹ ë¸”ë¡(Block_0, Block_1 ë“±)ì„ í™•ì¸
2. ê° ë¸”ë¡ì˜ Unity ì›”ë“œ ì¢Œí‘œë¥¼ `Mathf.RoundToInt()`ë¡œ ì •ìˆ˜ë¡œ ë³€í™˜
3. ë¶€ëª¨ë¥¼ GameBoardë¡œ ë³€ê²½ (ê³ ì •ëœ ë¸”ë¡ì´ë¯€ë¡œ)
4. ê·¸ë¦¬ë“œ ë°°ì—´ì— ì €ì¥

### 2. Tetrominoì— ë¸”ë¡ ê³ ì • í•¨ìˆ˜ ì¶”ê°€

`Tetromino.cs`ì— ì¶”ê°€:

```csharp
public void LockPiece()
{
    // GameBoardì— ë¸”ë¡ ì¶”ê°€
    if (gameBoard != null)
    {
        gameBoard.AddToGrid(this);
        
        // í–‰ ì œê±° í™•ì¸
        int linesCleared = gameBoard.ClearFullRows();
        
        // ì ìˆ˜ ì¶”ê°€ (7ë‹¨ê³„ì—ì„œ GameController ì—°ê²°)
        GameController gameController = FindObjectOfType<GameController>();
        if (gameController != null)
        {
            gameController.AddScore(linesCleared);
        }
        
        // ë‹¤ìŒ ë¸”ë¡ ìƒì„± (8ë‹¨ê³„ì—ì„œ Spawner ì—°ê²°)
        Spawner spawner = FindObjectOfType<Spawner>();
        if (spawner != null)
        {
            spawner.SpawnNext();
        }
    }
    
    // í˜„ì¬ Tetromino ë¶€ëª¨ ì˜¤ë¸Œì íŠ¸ ì‚­ì œ (ìì‹ì€ ì´ë¯¸ GameBoardë¡œ ì´ë™ë¨)
    Destroy(gameObject);
}
```

### 3. MoveDown í•¨ìˆ˜ ìˆ˜ì •

4ë‹¨ê³„ì—ì„œ ë§Œë“  `MoveDown()` í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤:

```csharp
public void MoveDown()
{
    if (ValidMove(Vector3.down))
    {
        transform.position += Vector3.down;
    }
    else
    {
        // ë” ì´ìƒ ë‚´ë ¤ê°ˆ ìˆ˜ ì—†ìœ¼ë©´ ë¸”ë¡ ê³ ì •
        LockPiece();
    }
}
```

### 4. í–‰ ì œê±° í•¨ìˆ˜ êµ¬í˜„

`GameBoard.cs`ì— ì¶”ê°€:

```csharp
public void ClearFullRows()
{
    for (int y = 0; y < height; y++)
    {
        if (IsRowFull(y))
        {
            ClearRow(y);
            MoveRowsDown(y);
            y--;  // ë‹¤ì‹œ í™•ì¸
        }
    }
}

bool IsRowFull(int row)
{
    for (int x = 0; x < width; x++)
    {
        if (grid[x, row] == null)
            return false;
    }
    return true;
}

void ClearRow(int row)
{
    for (int x = 0; x < width; x++)
    {
        if (grid[x, row] != null)
        {
            Destroy(grid[x, row].gameObject);
            grid[x, row] = null;
        }
    }
}

void MoveRowsDown(int clearedRow)
{
    // ìœ„ì˜ í–‰ë“¤ì„ ì•„ë˜ë¡œ ì´ë™
    for (int y = clearedRow + 1; y < height; y++)
    {
        for (int x = 0; x < width; x++)
        {
            if (grid[x, y] != null)
            {
                // í•œ ì¹¸ ì•„ë˜ë¡œ ì´ë™
                grid[x, y - 1] = grid[x, y];
                grid[x, y] = null;
                
                // ì‹œê°ì  ìœ„ì¹˜ë„ ì—…ë°ì´íŠ¸
                grid[x, y - 1].position += Vector3.down;
            }
        }
    }
}

// ì œê±°í•œ í–‰ ê°œìˆ˜ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •
public int ClearFullRows()
{
    int linesCleared = 0;
    
    for (int y = 0; y < height; y++)
    {
        if (IsRowFull(y))
        {
            ClearRow(y);
            MoveRowsDown(y);
            y--;  // ë‹¤ì‹œ í™•ì¸ (í•œ ì¹¸ ì•„ë˜ë¡œ ë‚´ë ¤ì™”ìœ¼ë¯€ë¡œ)
            linesCleared++;
        }
    }
    
    return linesCleared;
}
```

## ğŸ”— ì´ì „ ë‹¨ê³„ì™€ì˜ ì—°ê²°

ì´ ë‹¨ê³„ì—ì„œëŠ”:
- **3ë‹¨ê³„ì˜ í”„ë¦¬íŒ¹**: ìì‹ ë¸”ë¡ë“¤ì„ ì§ì ‘ ì‚¬ìš© (`transform.GetChild()`)
- **4ë‹¨ê³„ì˜ `MoveDown()`**: ë¸”ë¡ì´ ë” ì´ìƒ ë‚´ë ¤ê°ˆ ìˆ˜ ì—†ì„ ë•Œ `LockPiece()` í˜¸ì¶œ
- **2ë‹¨ê³„ì˜ `GameBoard`**: ê·¸ë¦¬ë“œì— ë¸”ë¡ ì €ì¥ ë° í–‰ ì œê±°
- **7ë‹¨ê³„ì˜ `GameController`**: í–‰ ì œê±° ê°œìˆ˜ë¥¼ ë°›ì•„ì„œ ì ìˆ˜ ê³„ì‚°

**ì‘ë™ íë¦„**:
1. ë¸”ë¡ì´ ë°”ë‹¥ì— ë‹¿ìŒ â†’ `MoveDown()`ì—ì„œ `LockPiece()` í˜¸ì¶œ
2. `LockPiece()` â†’ `gameBoard.AddToGrid()`ë¡œ ìì‹ ë¸”ë¡ë“¤ì„ ê·¸ë¦¬ë“œì— ì €ì¥
3. `gameBoard.ClearFullRows()` â†’ ê°€ë“ ì°¬ í–‰ ì œê±°
4. ì œê±°í•œ í–‰ ê°œìˆ˜ ë°˜í™˜ â†’ GameControllerì—ì„œ ì ìˆ˜ë¡œ ë³€í™˜

**ì°¸ê³  ë¸”ë¡œê·¸ ë°©ì‹ì˜ íŠ¹ì§•**:
- ìì‹ ë¸”ë¡ì„ `transform.GetChild()`ë¡œ ì§ì ‘ ì ‘ê·¼
- Unity ì¢Œí‘œë¥¼ `Mathf.RoundToInt()`ë¡œ ì •ìˆ˜ë¡œ ë³€í™˜
- ë¶€ëª¨ë¥¼ GameBoardë¡œ ë³€ê²½í•˜ì—¬ ê³ ì •

## âœ… í™•ì¸ ì‚¬í•­

- [ ] í•œ ì¤„ì„ ì±„ìš°ë©´ ì œê±°ë˜ëŠ”ê°€?
- [ ] ìœ„ ë¸”ë¡ë“¤ì´ ì•„ë˜ë¡œ ë‚´ë ¤ì˜¤ëŠ”ê°€?
- [ ] ì—¬ëŸ¬ ì¤„ì„ ë™ì‹œì— ì œê±°í•  ìˆ˜ ìˆëŠ”ê°€?

---

[â† ì´ì „ ë‹¨ê³„: 5ë‹¨ê³„ - ì…ë ¥ ì²˜ë¦¬](./5ë‹¨ê³„-ì…ë ¥-ì²˜ë¦¬.md) | [ë‹¤ìŒ ë‹¨ê³„: 7ë‹¨ê³„ - ì ìˆ˜ ë° ë ˆë²¨ ì‹œìŠ¤í…œ â†’](./7ë‹¨ê³„-ì ìˆ˜-ë ˆë²¨-ì‹œìŠ¤í…œ.md)
